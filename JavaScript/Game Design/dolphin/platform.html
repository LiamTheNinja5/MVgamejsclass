<html>
<head>
<title> Level Builder </title>
<script src="https://simplycodingcourses.com/files/simply.js"></script>
<script>
//var w = window.innerWidth;
//var h = window.innerHeight;
var level = [];
function start(){
sjs.open("target",800,500);

//Background Music
var playM = new Audio('Music/ova.mp3');
var toggle = true;
var musicOn = false;
sjs.keyDown(SPACE_KEY, function(){
if(toggle == true){
if(musicOn == false){
playM.play();
musicOn = true;
} else {
playM.pause();
musicOn = false;
}
toggle = false;
setTimeout(function(){
toggle = true;
},1000);
} //end if toggle statement
}); //end keyDown function


var background = new sjs.Image("Images/background.png");
background.setSize(2500, sjs.getHeight());

var testBtn = new sjs.Button("Test", function(){
    localStorage.setItem('level', sjs.saveImageArray(level));
    window.open('test.html', '_blank');
});

var showBtn = new sjs.Button("Show", function(){
var output = document.querySelector("#output");
output.innerHTML = sjs.saveImageArray(level);
});

showBtn.offset(75, 0);

sjs.loadImageArray('[{"width":136,"height":30,"x":144,"y":384,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image",draggable}]')
sjs.loadImageArray('[{"width":136,"height":30,"x":390,"y":287,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":669.6400065371658,"y":249,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":898.6985486467297,"y":293,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":66,"height":15,"x":1137.5972886153152,"y":319.5,"sx":0,"sy":0,"topSpeed":10,"src":"Images/jump_pad.png","alt":"add text","type":"jump_pad","friction":0.05,"classType":"Image"},{"width":66,"height":15,"x":1320.2835965262627,"y":312.5,"sx":0,"sy":0,"topSpeed":10,"src":"Images/jump_pad.png","alt":"add text","type":"jump_pad","friction":0.05,"classType":"Image"},{"width":21,"height":30,"x":1344.343085664848,"y":245,"sx":0,"sy":0,"topSpeed":10,"src":"Images/power_up.png","alt":"add text","type":"powerUp","friction":0.05,"classType":"Image"},{"width":21,"height":30,"x":1156.343085664848,"y":242,"sx":0,"sy":0,"topSpeed":10,"src":"Images/power_up.png","alt":"add text","type":"powerUp","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1496.8430856648483,"y":255,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":81,"height":93,"x":1523.3812319570075,"y":152,"sx":0,"sy":0,"topSpeed":10,"src":"Images/l_enemy.gif","alt":"add text","type":"enemy","facingLeft":true,"left_img":"Images/l_enemy.gif","right_img":"Images/r_enemy.gif","friction":0,"classType":"Image","noBounds":true},{"width":136,"height":30,"x":1770.692588276544,"y":275,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":2023.26962230868,"y":245,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":2262.3282185352,"y":314,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":31,"height":80,"x":2469,"y":417,"sx":0,"sy":0,"topSpeed":10,"src":"Images/flag_bad.png","alt":"add text","type":"flag","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1802,"y":470,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1799.452234901238,"y":455,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1795.452234901238,"y":442,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1797.452234901238,"y":425,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1790.952234901238,"y":406,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1788.952234901238,"y":390,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1790.192588276544,"y":378,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1786.192588276544,"y":367,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1782.192588276544,"y":357,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1784.192588276544,"y":344,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1780.192588276544,"y":334,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1776.192588276544,"y":318,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1778.192588276544,"y":308,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1772.192588276544,"y":290,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":136,"height":30,"x":1769.1726044465443,"y":258,"sx":0,"sy":0,"topSpeed":10,"src":"Images/platform.png","alt":"add text","type":"platform","friction":0.05,"classType":"Image"},{"width":81,"height":93,"x":945.5,"y":407,"sx":1.5,"sy":0,"ay":1,"topSpeed":10,"src":"Images/r_enemy.gif","alt":"add text","type":"enemy","facingLeft":false,"left_img":"Images/l_enemy.gif","right_img":"Images/r_enemy.gif","friction":0,"classType":"Image","noBounds":true},{"width":81,"height":93,"x":942.952234901238,"y":407,"sx":-5,"sy":1,"ay":1,"topSpeed":10,"src":"Images/l_enemy.gif","alt":"add text","type":"enemy","facingLeft":true,"left_img":"Images/l_enemy.gif","right_img":"Images/r_enemy.gif","friction":0,"classType":"Image","noBounds":true},{"width":25,"height":30,"x":195.5,"y":359,"sx":0,"sy":0,"topSpeed":10,"src":"Images/score.gif","alt":"add text","type":"score","friction":0.05,"classType":"Image"},{"width":25,"height":30,"x":455.63627557056384,"y":245,"sx":0,"sy":0,"topSpeed":10,"src":"Images/score.gif","alt":"add text","type":"score","friction":0.05,"classType":"Image"},{"width":25,"height":30,"x":722.6947797982587,"y":221,"sx":0,"sy":0,"topSpeed":10,"src":"Images/score.gif","alt":"add text","type":"score","friction":0.05,"classType":"Image"},{"width":25,"height":30,"x":954.8593022749538,"y":245,"sx":0,"sy":0,"topSpeed":10,"src":"Images/score.gif","alt":"add text","type":"score","friction":0.05,"classType":"Image"},{"width":25,"height":30,"x":1828.160533239215,"y":224,"sx":0,"sy":0,"topSpeed":10,"src":"Images/score.gif","alt":"add text","type":"score","friction":0.05,"classType":"Image"},{"width":25,"height":30,"x":2083.219075348779,"y":216,"sx":0,"sy":0,"topSpeed":10,"src":"Images/score.gif","alt":"add text","type":"score","friction":0.05,"classType":"Image"},{"width":25,"height":30,"x":2317.5,"y":289,"sx":0,"sy":0,"topSpeed":10,"src":"Images/score.gif","alt":"add text","type":"score","friction":0.05,"classType":"Image"}]')


//Player properties
var player = new sjs.Image("Images/r_idle.png");
player.type = "player";
player.setSize(117,117);
player.setGravity(10);
player.bottom();
player.friction = .3;
player.accel = .6;
player.noBounds = true;
sjs.scrollable(player,background);


//Ball properties
var ball = new sjs.Image("Images/spike.png");
var can_collide =true
ball.type = "ball";
ball.setSize(50,50);
ball.center();
ball.friction = 0.1
ball.accel = 0.3;
ball.setGravity(.5);
ball.bounce();

// ball.pushRight(3);
// ball.pushUp(4);





//Player movement controls
var r_images = ["Images/r_walk-0.png", "Images/r_walk-1.png", "Images/r_walk-2.png", "Images/r_walk-3.png", "Images/r_walk-4.png", "Images/r_walk-5.png", "Images/r_walk-6.png", "Images/r_walk-7.png"];
var l_images = ["Images/l_walk-0.png", "Images/l_walk-1.png", "Images/l_walk-2.png", "Images/l_walk-3.png", "Images/l_walk-4.png", "Images/l_walk-5.png", "Images/l_walk-6.png", "Images/l_walk-7.png"];
var r_jumps = ["Images/r_jump-0.png", "Images/r_jump-01.png", "Images/r_jump-02.png", "Images/r_jump-03.png", "Images/r_jump-04.png", "Images/r_jump-05.png", "Images/r_jump-06.png", "Images/r_jump-07.png", "Images/r_jump-08.png", "Images/r_jump-09.png", "Images/r_jump-10.png", "Images/r_jump-11.png", "Images/r_jump-12.png", "Images/r_jump-13.png"];
var l_jumps = ["Images/l_jump-0.png", "Images/l_jump-01.png", "Images/l_jump-02.png", "Images/l_jump-03.png", "Images/l_jump-04.png", "Images/l_jump-05.png", "Images/l_jump-06.png", "Images/l_jump-07.png", "Images/l_jump-08.png", "Images/l_jump-09.png", "Images/l_jump-10.png", "Images/l_jump-11.png", "Images/l_jump-12.png", "Images/l_jump-13.png"];

var r_facing = true;
var r_track = 0;
var l_track = 0;

sjs.keyDown(RIGHT_KEY, function(){
r_facing = true;
r_track = r_track + 1;
player.pushRight(2);
player.setImage(r_images[r_track]);
if(r_track == 7){
r_track = 0;
}
if(r_track >= 8){
//player.setImage("Images/r_jump-0.png");
player.setImage(r_jumps[r_track-8]);
if(r_track == 21){
r_track = 0;
}
}
}); //end Right key

sjs.keyDown(LEFT_KEY, function(){
r_facing = false;
l_track = l_track + 1;
player.pushLeft(2);
player.setImage(l_images[l_track]);
if(l_track == 7){
l_track = 0;
}
if(l_track >= 8){
//player.setImage("Images/l_jump-0.png");
player.setImage(l_jumps[l_track-8]);
if(l_track == 21){
l_track = 0;
}
}
}); //end Left key

//Jumping Code
var canJump = true;
sjs.keyDown(UP_KEY, function(){
    if(canJump == true){
canJump = false;
player.pushUp(15);
if(r_facing == true){
    player.setImage("Images/r_jump-03.png");
r_track = 8;
} else {
    player.setImage("Images/l_jump-03.png");
l_track = 8;
}
} //end if statement

}); //end KeyDown Function

window.addEventListener("keyup", function(e){

if(e.keyCode == RIGHT_KEY){
player.setImage("Images/r_idle.png");
r_track = 0;
} else if (e.keyCode == LEFT_KEY){
player.setImage("Images/l_idle.png");
l_track = 0;
} //end if statement


//if (sjs.getY(ball)<50){
//    sjs.removeGravity(ball);
//    sjs.stop(ball);
//}

}); //end EventListener function

//onHit functions

sjs.onHit("player","platform", function(x,y){
    sjs.stoppedBy(x,y);

});

sjs.onHit("enemy","bottom_screen", function(x,y){
sjs.stoppedBy(x,y);
});

sjs.onHit("enemy",["left_screen","right_screen"], function(x,y){
sjs.bounceOff(x,y);
});

sjs.onHit("enemy","platform", function(x,y){
if(x.isAboveOf(y) == true){
sjs.stoppedBy(x,y);
} else {
sjs.bounceOff(x,y);
}
});

sjs.onHit("player","jump_pad", function(x,y){
if(x.isAboveOf(y) == true){
player.pushUp(50);
} else {
sjs.stoppedBy(x,y);
}
});

sjs.onHit("trash",["platform","jump_pad", "powerUp","score","enemy","flag","grass_block"], function(x,y){
y.destroy();
sjs.removeFromArray(level,y);
});

sjs.onHit("player","bottom_screen",function(x,y){
sjs.stoppedBy(x,y);
if(canJump == false){
canJump = true;
if(r_facing == true){
    player.setImage("Images/r_idle.png");
r_track = 0;
} else {
    player.setImage("Images/l_idle.png");
l_track = 0;
}
}
});

sjs.onHit("player",["right_screen","left_screen","top_screen"],function(x,y){
sjs.stoppedBy(x,y);
});

sjs.onHit("ball","platform",function(x,y){
sjs.stoppedBy(x,y);
});

sjs.onHit("ball","ball_hold",function(x,y){
sjs.stoppedBy(x,y);
});

sjs.onHit("player","ball", function(x,y){

    if(x.isLeftOf(y) == true && x.isTopOf(y) == false && r_track != 0 && can_collide == true){
        
    ball.pushRight(5);
    ball.pushUp(5);
    sjs.stoppedBy(x,y);
    can_collide = false;
    
    }

    if(x.isRightOf(y) == true && x.isTopOf(y) == false && l_track != 0 && can_collide == true){
        
        ball.pushLeft(5);
        ball.pushUp(5);
        sjs.stoppedBy(x,y);
        can_collide = false;
    }

    if(x.isBottomOf(y) == true && can_collide == true){
        
        
        ball.pushUp(5);
        sjs.stoppedBy(x,y);
        can_collide = false;
    }

    setTimeout( can_collide = true, 500)

});

sjs.onHit("ball","bottom_screen",function(x,y){
sjs.stoppedBy(x,y);

});


sjs.onHit("ball","grass_block",function(x,y){
sjs.bounceOff(x,y);
ball.pushRight(5);
ball.pushUp(5);

});





var trash = new sjs.Text("Trash",15,"orange");
trash.type = "trash";
trash.moveTo(720,10);
trash.fixed = true;
trash.setHeight(60);
trash.node.style.background = "green";
trash.node.style.borderTop = "4px solid yellow";
} //end start

//Platform Function

function platform(){
var platform = new sjs.Image("Images/platform.png");
level.push(platform);
platform.type = "platform";
platform.setHeight(30);
platform.center().offset(-sjs.gx,10);
platform.onMouseDown(function(){
platform.draggable();
platform.follow(sjs.mouse);
});
}
function powerUp(){
    var powerUp = new sjs.Image("Images/power_up.png");
level.push(powerUp);
powerUp.type = "powerUp";
powerUp.setHeight(30);
powerUp.center().offset(-sjs.gx,10);
powerUp.onMouseDown(function(){
powerUp.draggable();
powerUp.follow(sjs.mouse);
});
}
function score(){
    var score = new sjs.Image("Images/score.gif");
level.push(score);
score.type = "score";
score.setHeight(30);
score.center().offset(-sjs.gx,10);
score.onMouseDown(function(){
score.draggable();
score.follow(sjs.mouse);
});
}
function flag(){
    var flag = new sjs.Image("Images/flag_bad.png");
level.push(flag);
flag.type = "flag";
flag.setHeight(80);
flag.center().offset(-sjs.gx,10);
flag.onMouseDown(function(){
flag.draggable();
flag.follow(sjs.mouse);
});
}
function enemy(){
var enemy = new sjs.Image("Images/r_enemy.gif");
level.push(enemy);
enemy.type = "enemy";
enemy.center().offset(-sjs.gx,10);
enemy.friction = 0;
enemy.noBounds = true;
enemy.setHFlipImages("Images/l_enemy.gif","Images/r_enemy.gif");
enemy.onMouseDown(function(){
  enemy.follow(sjs.mouse);
   enemy.removeGravity();
   enemy.stop();
});
enemy.onMouseUp(function(){
 enemy.unfollow(sjs.mouse);
 enemy.setGravity();
 enemy.pushHFacing();
enemy.accel=.5;
});
} //end enemy function
function jumpPad(){
var jump_pad = new sjs.Image("Images/jump_pad.png");
level.push(jump_pad);
jump_pad.type = "jump_pad";
jump_pad.center().offset(-sjs.gx,10);
jump_pad.setHeight(15);
jump_pad.onMouseDown(function(){
jump_pad.draggable();
jump_pad.follow(sjs.mouse);
});
} //end jump_pad function
function ballhold(){
var ball_hold = new sjs.Image("Images/BallHold.png");
level.push(ball_hold);
ball_hold.type = "ball_hold";
ball_hold.center().offset(-sjs.gx,10);
ball_hold.setHeight(15);
ball_hold.setSize(80,80);
ball_hold.onMouseDown(function(){
ball_hold.draggable();
ball_hold.follow(sjs.mouse);
});
} //end ball hold function
function grass(){
var grass_block = new sjs.Image("Images/grass.png");
level.push(grass_block);
grass_block.type = "grass_block";
grass_block.center().offset(-sjs.gx,10);
grass_block.setHeight(15);
grass_block.setSize(80,80);
grass_block.onMouseDown(function(){
grass_block.draggable();
grass_block.follow(sjs.mouse);
});
} //end ball hold function


</script>
</head>
<body onload="start()">
<h1>
<center>
<input type="image" src="Images/platform.png" onclick="platform()"> 
<input type="image" src="Images/power_up.png" onclick="powerUp()"> 
<input type="image" src="Images/score.gif" onclick="score()"> 
<input type="image" src="Images/flag_bad.png" onclick="flag()"> 
<input type="image" src="Images/r_enemy.gif" onclick="enemy()"> 
<input type="image" src="Images/jump_pad.png" onclick="jumpPad()"> 
<input type="image" src="Images/BallHold.png" onclick="ballhold()"> 
<input type="image" src="Images/grass.png" onclick="grass()">
</center>
</h1>

<div id="target" style="margin:auto;background:grey;"></div>
<br/>
<div id="output" style="margin:0 50 0 50;"></div>
<br/><br/>
</body>
</html>